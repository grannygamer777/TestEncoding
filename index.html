<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ultra Delta Compression</title>
</head>
<body>
<h3>Ultra Delta Compressor (0–400 values)</h3>
<textarea id="input" rows="3" cols="60">0,0,400,400,300,300,200,200,100,100,321,124,222</textarea><br>
<button onclick="doEncode()">Encode</button>
<button onclick="doDecode()">Decode</button>
<p><b>Compressed:</b> <span id="compressed"></span></p>
<p><b>Decoded:</b> <span id="decoded"></span></p>

<script>
// --- Encode single number (0–2375) as "0a–99z" ---
function encodeSymbol(num) {
  if (num < 10) return num.toString();
  num -= 10;
  let prefix = Math.floor(num / 26);
  let letter = String.fromCharCode(97 + (num % 26));
  return prefix.toString() + letter;
}
function decodeSymbol(sym) {
  if (/^\d$/.test(sym)) return parseInt(sym);
  let prefix = parseInt(sym.slice(0, -1));
  let letter = sym.slice(-1);
  return 10 + prefix * 26 + (letter.charCodeAt(0) - 97);
}

// --- BigInt <-> symbol string (base-2376) ---
function bigIntToSymbols(n) {
  let base = 2376n;
  if (n === 0n) return "0";
  let parts = [];
  while (n > 0n) {
    let rem = Number(n % base);
    parts.push(encodeSymbol(rem));
    n = n / base;
  }
  return parts.reverse().join("");
}
function symbolsToBigInt(str) {
  let base = 2376n;
  let symbols = [];
  // greedy parse
  let i = 0;
  while (i < str.length) {
    if (/^\d$/.test(str[i])) {
      symbols.push(str[i]);
      i++;
    } else {
      let j = i;
      while (j < str.length && /[0-9]/.test(str[j])) j++;
      symbols.push(str.slice(i, j + 1));
      i = j + 1;
    }
  }
  let n = 0n;
  for (let sym of symbols) {
    n = n * base + BigInt(decodeSymbol(sym));
  }
  return n;
}

// --- ENCODE LIST ---
function encodeList(nums) {
  if (nums.length === 0) return "";

  // delta compress
  let deltas = [nums[0]];
  for (let i = 1; i < nums.length; i++) {
    deltas.push(nums[i] - nums[i - 1]);
  }

  // shift into positive range 0–800
  let shifted = deltas.map(d => d + 400);

  // pack into BigInt (base-801)
  let value = 0n;
  for (let s of shifted) {
    value = value * 801n + BigInt(s);
  }

  // encode as base-2376 string
  let compressed = bigIntToSymbols(value);

  // append length
  let lenSym = encodeSymbol(nums.length);
  return compressed + "-" + lenSym;
}

// --- DECODE LIST ---
function decodeList(code) {
  if (!code.includes("-")) return [];
  let [symStr, lenSym] = code.split("-");
  let length = decodeSymbol(lenSym);

  // unpack bigInt
  let value = symbolsToBigInt(symStr);

  // extract shifted deltas
  let shifted = [];
  for (let i = 0; i < length; i++) {
    shifted.unshift(Number(value % 801n));
    value = value / 801n;
  }

  let deltas = shifted.map(s => s - 400);

  // rebuild numbers
  let nums = [];
  if (deltas.length > 0) {
    nums.push(deltas[0]);
    for (let i = 1; i < deltas.length; i++) {
      nums.push(nums[nums.length - 1] + deltas[i]);
    }
  }
  return nums;
}

// --- UI glue ---
function doEncode() {
  let nums = document.getElementById("input").value.split(",").map(x => parseInt(x.trim()));
  let code = encodeList(nums);
  document.getElementById("compressed").innerText = code;
}
function doDecode() {
  let code = document.getElementById("compressed").innerText;
  let decoded = decodeList(code);
  document.getElementById("decoded").innerText = decoded.join(",");
}
</script>
</body>
</html>
