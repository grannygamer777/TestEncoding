<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Custom Compression</title>
</head>
<body>
<h3>Custom List Compressor (0aâ€“99z base-2376)</h3>
<textarea id="input" rows="3" cols="60">0,0,400,400,300,300,200,200,100,100,321,124,222</textarea><br>
<button onclick="doEncode()">Encode</button>
<button onclick="doDecode()">Decode</button>
<p><b>Compressed:</b> <span id="compressed"></span></p>
<p><b>Decoded:</b> <span id="decoded"></span></p>

<script>
// --- build alphabet ---
function encodeSymbol(num) {
  if (num < 10) return num.toString();
  num -= 10;
  let prefix = Math.floor(num / 26);
  let letter = String.fromCharCode(97 + (num % 26));
  return prefix.toString() + letter;
}

function decodeSymbol(sym) {
  if (/^\d$/.test(sym)) return parseInt(sym);
  let prefix = parseInt(sym.slice(0, -1));
  let letter = sym.slice(-1);
  return 10 + prefix * 26 + (letter.charCodeAt(0) - 97);
}

// base size
const BASE = 2376;

// encode big integer into base-2376 string
function bigIntToSymbols(value) {
  if (value === 0n) return "0";
  let parts = [];
  while (value > 0n) {
    let rem = Number(value % BigInt(BASE));
    parts.push(encodeSymbol(rem));
    value /= BigInt(BASE);
  }
  return parts.reverse().join("");
}

// decode base-2376 string back to BigInt
function symbolsToBigInt(str) {
  let value = 0n;
  // parse left-to-right, but need to chunk symbols correctly
  // symbols can be 1 digit ("0"-"9") or digit+letter ("0a"-"99z")
  let i = 0;
  while (i < str.length) {
    if (/^\d$/.test(str[i])) {
      // single digit symbol
      value = value * BigInt(BASE) + BigInt(decodeSymbol(str[i]));
      i++;
    } else {
      // must be multi-digit (like "23a")
      let j = i;
      while (j < str.length-1 && /\d/.test(str[j])) j++;
      let sym = str.slice(i, j+1);
      value = value * BigInt(BASE) + BigInt(decodeSymbol(sym));
      i = j+1;
    }
  }
  return value;
}

// pack list into one big integer
function packList(nums) {
  let value = 0n;
  for (let n of nums) {
    value = value * 401n + BigInt(n);
  }
  return value;
}

// unpack list from big integer
function unpackList(value, length) {
  let nums = [];
  for (let i=0; i<length; i++) {
    nums.push(Number(value % 401n));
    value /= 401n;
  }
  return nums.reverse();
}

// main encode
function encodeList(nums) {
  let value = packList(nums);
  let code = bigIntToSymbols(value);
  let lenCode = encodeSymbol(nums.length);
  return code + "-" + lenCode;
}

// main decode
function decodeList(code) {
  let [codePart, lenPart] = code.split("-");
  let length = decodeSymbol(lenPart);
  let value = symbolsToBigInt(codePart);
  return unpackList(value, length);
}

// UI
function doEncode() {
  let nums = document.getElementById("input").value.split(",").map(x => parseInt(x.trim()));
  let code = encodeList(nums);
  document.getElementById("compressed").innerText = code;
}
function doDecode() {
  let code = document.getElementById("compressed").innerText;
  let decoded = decodeList(code);
  document.getElementById("decoded").innerText = decoded.join(", ");
}
</script>
</body>
</html>
