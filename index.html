<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Emoji-Enhanced Compression</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    textarea { width: 100%; height: 80px; }
    .output { border: 1px solid #ccc; padding: 10px; margin-top: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>
<h2>Emoji-Enhanced Compression System</h2>

<p>Enter numbers (comma separated):</p>
<textarea id="input">0,0,400,400,300,300,200,200,100,100,321,124,222</textarea>
<br>
<button onclick="doEncode()">Encode</button>
<button onclick="doDecode()">Decode</button>

<h3>Compressed:</h3>
<div id="compressed" class="output"></div>
<h3>Decoded:</h3>
<div id="decoded" class="output"></div>

<script>
// Base symbols (old system)
const BASE_SYMBOLS = "!@#$%^&*()_+[]{}|;:,.<>?/`~-=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

// Add a block of emojis for repeats
const EMOJIS = [..."😀😃😄😁😆😅🤣😂🙂🙃😉😊😇🥰😍🤩😘😗☺️😚😙🥲😋😛😜🤪😝🤑🤗🤭🤫🤔🤐🤨😐😑😶🙄😏😒😞😔😟😕🙁☹️😣😖😫😩🥺😢😭😤😠😡🤬🤯😳🥵🥶😱😨😰😥😓"];

// Final alphabet = symbols + emojis
const ALPHABET = BASE_SYMBOLS + EMOJIS.join("");
const BASE = ALPHABET.length;

// Encode number -> base-N string
function numToToken(n) {
  if (n === 0) return ALPHABET[0];
  let out = "";
  while (n > 0) {
    out = ALPHABET[n % BASE] + out;
    n = Math.floor(n / BASE);
  }
  return out;
}

// Decode base-N string -> number
function tokenToNum(str) {
  let n = 0;
  for (let ch of str) {
    let idx = ALPHABET.indexOf(ch);
    if (idx < 0) throw new Error("Invalid character: " + ch);
    n = n * BASE + idx;
  }
  return n;
}

// Auto compression: if a number repeats 3+ times in sequence, replace it with an emoji token directly
function encodeList(nums) {
  let out = [];
  for (let i = 0; i < nums.length; ) {
    let current = nums[i];
    let count = 1;
    while (i + count < nums.length && nums[i + count] === current) {
      count++;
    }
    if (count >= 3 && count <= EMOJIS.length) {
      // map directly to emoji index
      out.push(EMOJIS[count - 1]); // repeat length encoded as emoji
      out.push(numToToken(current)); // number encoded normally
    } else {
      for (let j = 0; j < count; j++) {
        out.push(numToToken(current));
      }
    }
    i += count;
  }
  return out.join(" ");
}

function decodeList(str) {
  let parts = str.split(/\s+/).filter(x=>x.length>0);
  let out = [];
  for (let i = 0; i < parts.length; i++) {
    let token = parts[i];
    let emojiIndex = EMOJIS.indexOf(token);
    if (emojiIndex >= 0) {
      // emoji = repeat count
      let count = emojiIndex + 1;
      let num = tokenToNum(parts[++i]); // next token is the value
      for (let j = 0; j < count; j++) {
        out.push(num);
      }
    } else {
      out.push(tokenToNum(token));
    }
  }
  return out;
}

// UI
function doEncode() {
  let nums = document.getElementById("input").value.split(",").map(x=>parseInt(x.trim())).filter(x=>!isNaN(x));
  let code = encodeList(nums);
  document.getElementById("compressed").innerText = code;
}

function doDecode() {
  let code = document.getElementById("compressed").innerText;
  let decoded = decodeList(code);
  document.getElementById("decoded").innerText = decoded.join(",");
}
</script>
</body>
</html>
